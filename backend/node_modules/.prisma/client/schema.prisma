generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int     @id @default(autoincrement())
  email    String  @unique
  password String
  name     String
  avatar   String?
  bio      String?
  role     Role    @default(SEEKER)

  // Profile Details
  birthDate   DateTime?
  gender      String?
  occupation  String?
  lifestyle   Json? // { smoker: boolean, pet: boolean, etc. }
  preferences Json? // { budgetMin, budgetMax, preferredLocations: [] }

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  listings         Listing[]
  favorites        Favorite[]
  sentLikes        Like[]     @relation("Sender")
  receivedLikes    Like[]     @relation("Receiver")
  matchesAsUser1   Match[]    @relation("User1")
  matchesAsUser2   Match[]    @relation("User2")
  sentMessages     Message[]  @relation("SentMessages")
  receivedMessages Message[]  @relation("ReceivedMessages")
}

model Listing {
  id      Int  @id @default(autoincrement())
  ownerId Int
  owner   User @relation(fields: [ownerId], references: [id])

  title         String
  description   String
  price         Float
  location      String
  coordinates   Json? // { lat, lng }
  images        String[]
  amenities     String[]
  rules         String[]
  availableFrom DateTime?
  roomType      RoomType?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  likes     Like[]
  favorites Favorite[]
}

model Like {
  id         Int  @id @default(autoincrement())
  fromUserId Int
  fromUser   User @relation("Sender", fields: [fromUserId], references: [id])

  // Target could be a Listing or a User
  toUserId Int?
  toUser   User? @relation("Receiver", fields: [toUserId], references: [id])

  toListingId Int?
  toListing   Listing? @relation(fields: [toListingId], references: [id])

  createdAt DateTime @default(now())
}

model Match {
  id Int @id @default(autoincrement())

  user1Id Int
  user1   User @relation("User1", fields: [user1Id], references: [id])
  user2Id Int
  user2   User @relation("User2", fields: [user2Id], references: [id])

  listingId Int?

  createdAt DateTime @default(now())

  messages Message[]
}

model Message {
  id      Int   @id @default(autoincrement())
  matchId Int
  match   Match @relation(fields: [matchId], references: [id])

  senderId   Int
  sender     User @relation("SentMessages", fields: [senderId], references: [id])
  receiverId Int
  receiver   User @relation("ReceivedMessages", fields: [receiverId], references: [id])

  content   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Favorite {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  listingId Int
  listing   Listing  @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())
}

enum Role {
  OWNER
  SEEKER
  BOTH
}

enum RoomType {
  SINGLE
  DOUBLE
  SUITE
}
